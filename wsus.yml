# This playbook installs and enables IIS on Windows hosts

- name: Install WSUS
  hosts: wsus
  gather_facts: false
  tasks:
    - name: Install WSUS
      win_feature:
        name: UpdateServices
        state: present
        include_management_tools: yes

    - name: Create WSUS directory
      win_file:
       path: C:\WSUS
       state: directory

    - name: Change the working directory to C:\Program Files\Update Services\Tools\ before executing WsusUtil.
      win_shell: .\WsusUtil.exe PostInstall CONTENT_DIR=C:\WSUS
      args:
        chdir: C:\Program Files\Update Services\Tools\

    - name: Download and Install ReportViewer 2008 from artefact repository
      win_package:
        name: Microsoft ReportViewer 2008
        path: http://wtr-watm-artefactrepo.johnlewis.co.uk:8081/nexus/service/local/repositories/A0466-VRA-Releases/content/Microsoft/Windows/Packages/reportViewer/2008/reportViewer-2008.exe
        product_id: '{5E152D08-572A-3375-8FDE-DAD1EFB379BA}'
        arguments: /install /passive /norestart